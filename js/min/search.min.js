var SearchService=function(e){var t=this;t.config=$.extend({per_page:10,form:".searchform",input:".searchform .search_input",modal:"#modal-search",modalBody:"#modal-search .modal-body",modalFooter:"#modal-search .modal-footer",overlay:"#modal-search .overlay",resultContainer:"#modal-search .results",metadata:"#modal-search .meta",ajaxContent:"#modal-search .ajax-content, #modal-search .loading",loadingBar:"#modal-search .loading .bar",errorContainer:"#modal-search .modal-footer .error",closeButton:"#modal-search .close",nextButton:"#modal-search .next",prevButton:"#modal-search .prev"},e),t.dom={searchForm:$(t.config.form),searchInput:$(t.config.input),modal:$(t.config.modal),modalBody:$(t.config.modalBody),modalFooter:$(t.config.modalFooter),overlay:$(t.config.overlay),resultContainer:$(t.config.resultContainer),closeButton:$(t.config.closeButton),prevButton:$(t.config.prevButton),nextButton:$(t.config.nextButton),metadata:$(t.config.metadata),ajaxContent:$(t.config.ajaxContent),errorContainer:$(t.config.errorContainer),loadingBar:$(t.config.loadingBar)},t.open=!1,t.queryText="",t.nav={next:-1,prev:-1,total:0,current:1},t.nextPage=function(){-1!==t.nav.next&&t.query(t.queryText,t.nav.next)},t.prevPage=function(){-1!==t.nav.prev&&t.query(t.queryText,t.nav.prev)},t.buildResult=function(e,t,o){var n="";return n="<li>",n+="<a class='result' href='"+e+"'>",n+="<span class='title'>"+t+"</span>",n+="<span class='digest'>"+o+"</span>",n+="<span class='icon icon-chevron-thin-right'></span>",n+="</a>",n+="</li>"},t.close=function(){t.open=!1,t.dom.modal.fadeOut(),$("body").removeClass("modal-active")},t.onSubmit=function(e){t.open||(t.dom.modal.fadeIn(),$("body").addClass("modal-active")),t.dom.searchInput.each(function(t,o){$(o).val(e)}),document.activeElement.blur(),t.query(e,1)},t.uiBeforeQuery=function(){t.dom.errorContainer.hide(),t.dom.ajaxContent.removeClass("loaded")},t.uiAfterQuery=function(){t.dom.modalBody.scrollTop(0),t.dom.ajaxContent.addClass("loaded")},t.onQueryError=function(e,o){var n="";n="success"===o?'No result found for "'+e+'".':"timeout"===o?"Unfortunate timeout.":"Mysterious failure.",t.dom.resultContainer.html(""),t.dom.errorContainer.html(n),t.dom.errorContainer.show()},t.init=function(){t.dom.searchForm.each(function(e,o){$(o).on("submit",function(e){e.preventDefault(),t.queryText=$(this).children(".search_input").val(),t.onSubmit(t.queryText)})}),t.dom.overlay.on("click",t.close),t.dom.nextButton.on("click",t.nextPage),t.dom.prevButton.on("click",t.prevPage),t.dom.closeButton.on("click",t.close)}},GoogleCustomSearch=function(e){SearchService.apply(this,arguments);var t=this,o="https://www.googleapis.com/customsearch/v1";t.buildResultList=function(e){var o="";return $.each(e,function(e,n){var a=n.link,r=n.title,i=(n.htmlSnippet||"").replace("<br>","");o+=t.buildResult(a,r,i)}),o},t.buildMetadata=function(e){e.queries&&e.queries.request&&"0"!==e.queries.request[0].totalResults?(t.nav.current=e.queries.request[0].startIndex,t.nav.currentCount=e.queries.request[0].count,t.nav.total=parseInt(e.queries.request[0].totalResults),t.dom.metadata.children(".total").html(t.nav.total),t.dom.metadata.children(".range").html(t.nav.current+"-"+(t.nav.current+t.nav.currentCount-1)),t.dom.metadata.show()):t.dom.metadata.hide(),e.queries&&e.queries.nextPage?(t.nav.next=e.queries.nextPage[0].startIndex,t.dom.nextButton.show()):(t.nav.next=-1,t.dom.nextButton.hide()),e.queries&&e.queries.previousPage?(t.nav.prev=e.queries.previousPage[0].startIndex,t.dom.prevButton.show()):(t.nav.prev=-1,t.dom.prevButton.hide())},t.query=function(e,n,a){t.uiBeforeQuery(),$.get(o,{key:t.config.apiKey,cx:t.config.engineId,q:e,start:n,num:t.config.per_page},function(o,n){if("success"===n&&o.items&&o.items.length>0){var r=t.buildResultList(o.items);t.dom.resultContainer.html(r)}else t.onQueryError(e,n);t.buildMetadata(o),t.uiAfterQuery(),a&&a(o)})},t.init()},HexoSearch=function(e){SearchService.apply(this,arguments);var t=this,o="/content.json";t.cache="",t.contentSearch=function(e,t){var o=e.title.trim().toLowerCase(),n=e.text.trim().toLowerCase(),a=t.trim().toLowerCase().split(" "),r=!1,i=-1,u=-1,s=-1;return""!==o&&""!==n&&$.each(a,function(t,c){if(i=o.indexOf(c),u=n.indexOf(c),0>i&&0>u?r=!1:(r=!0,0>u&&(u=0),0==t&&(s=u)),r)if(n=e.text.trim(),s>=0){var l=Math.max(s-30,0),d=0===l?Math.min(200,n.length):Math.min(s+170,n.length),m=n.substring(l,d);a.forEach(function(e){var t=new RegExp(e,"gi");m=m.replace(t,"<b>"+e+"</b>")}),e.digest=m}else{var d=Math.min(200,n.length);e.digest=n.trim().substring(0,d)}}),r},t.buildResultList=function(e,o){var n=[],a="";return $.each(e,function(e,n){t.contentSearch(n,o)&&(a+=t.buildResult(n.permalink,n.title,n.digest))}),a},t.buildMetadata=function(e){t.dom.modalFooter.hide()},t.query=function(e,n,a){if(t.uiBeforeQuery(),t.cache){var r="";r+=t.buildResultList(t.cache.pages,e),r+=t.buildResultList(t.cache.posts,e),t.dom.resultContainer.html(r),t.buildMetadata(t.cache),t.uiAfterQuery(),a&&a(t.cache)}else $.get(o,{key:t.config.apiKey,cx:t.config.engineId,q:e,start:n,num:t.config.per_page},function(o,n){if("success"!==n||!o||!o.posts&&!o.pages||o.posts.length<1&&o.pages.length<1)t.onQueryError(e,n);else{t.cache=o;var r="";r+=t.buildResultList(o.pages,e),r+=t.buildResultList(o.posts,e),t.dom.resultContainer.html(r)}t.buildMetadata(o),t.uiAfterQuery(),a&&a(o)})},t.init()},BingSearch=function(e){SearchService.apply(this,arguments);var t=this,o="";t.buildResultList=function(e){},t.buildMetadata=function(e){},t.query=function(e,t,o){}};